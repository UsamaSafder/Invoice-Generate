<form #input="ngForm" (ngSubmit)="AddDetails(input)" class="invoice-form" novalidate>

  <div class="form-header">
    <h1>Create New Invoice</h1>
    <p>Please fill in the details below to generate a customer invoice.</p>
    <p class="alert"><strong>Remember not to Forget Your Customer ID</strong></p>
  </div>

  <section class="form-block customer-info">
    <h1>Customer Info</h1>

    <div class="input-box">
      <input
        type="number"
        [(ngModel)]="CId"
        name="CId"
        #CIdInput="ngModel"
        placeholder="Customer ID"
        required
        (blur)="checkCIdUnique(CId)"
        min="1"
      />
      <div class="error" *ngIf="CIdInput.invalid && (CIdInput.dirty || CIdInput.touched)">
        <small *ngIf="CIdInput.errors?.['required']">Customer ID is required.</small>
        <small *ngIf="CIdInput.errors?.['min']">Customer ID must be greater than 0.</small>
        <small *ngIf="CIdExists">This Customer ID is already taken.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="text"
        ngModel
        name="Name"
        #NameInput="ngModel"
        placeholder="Customer Name"
        required
        minlength="3"
        pattern="^[A-Za-z ]+$"
      />
      <div class="error" *ngIf="NameInput.invalid && (NameInput.dirty || NameInput.touched)">
        <small *ngIf="NameInput.errors?.['required']">Customer Name is required.</small>
        <small *ngIf="NameInput.errors?.['minlength']">Minimum 3 characters required.</small>
        <small *ngIf="NameInput.errors?.['pattern']">Only letters and spaces allowed.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="tel"
        ngModel
        name="PhoneNumber"
        #PhoneNumberInput="ngModel"
        placeholder="Customer Phone"
        required
        pattern="^\+?[0-9]{7,15}$"
      />
      <div class="error" *ngIf="PhoneNumberInput.invalid && (PhoneNumberInput.dirty || PhoneNumberInput.touched)">
        <small *ngIf="PhoneNumberInput.errors?.['required']">Customer Phone is required.</small>
        <small *ngIf="PhoneNumberInput.errors?.['pattern']">Phone must be 7–15 digits, optional leading +.</small>
      </div>
    </div>
  </section>

  <section class="form-block company-info">
    <h1>Company Info</h1>

    <div class="input-box">
      <input
        type="text"
        ngModel
        name="CName"
        #CNameInput="ngModel"
        placeholder="Company Name"
        required
        minlength="2"
        pattern="^(?!\d+$)[A-Za-z0-9 ]+$"
      />
      <div class="error" *ngIf="CNameInput.invalid && (CNameInput.dirty || CNameInput.touched)">
        <small *ngIf="CNameInput.errors?.['required']">Company Name is required.</small>
        <small *ngIf="CNameInput.errors?.['minlength']">Minimum 2 characters required.</small>
        <small *ngIf="CNameInput.errors?.['pattern']">Must include letters, not all numbers.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="text"
        ngModel
        name="Address"
        #AddressInput="ngModel"
        placeholder="Company Address"
        required
        minlength="5"
        pattern="^(?=.*[A-Za-z])(?=.*\d).+$"
      />
      <div class="error" *ngIf="AddressInput.invalid && (AddressInput.dirty || AddressInput.touched)">
        <small *ngIf="AddressInput.errors?.['required']">Address is required.</small>
        <small *ngIf="AddressInput.errors?.['minlength']">Minimum 5 characters required.</small>
        <small *ngIf="AddressInput.errors?.['pattern']">Must include both letters and numbers.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="tel"
        ngModel
        name="CompanyPhone"
        #CompanyPhoneInput="ngModel"
        placeholder="Company Phone"
        required
        pattern="^\+?[0-9]{7,15}$"
      />
      <div class="error" *ngIf="CompanyPhoneInput.invalid && (CompanyPhoneInput.dirty || CompanyPhoneInput.touched)">
        <small *ngIf="CompanyPhoneInput.errors?.['required']">Company Phone is required.</small>
        <small *ngIf="CompanyPhoneInput.errors?.['pattern']">Phone must be 7–15 digits, optional +.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="email"
        ngModel
        name="Email"
        #EmailInput="ngModel"
        placeholder="Company Email"
        required
        email
      />
      <div class="error" *ngIf="EmailInput.invalid && (EmailInput.dirty || EmailInput.touched)">
        <small *ngIf="EmailInput.errors?.['required']">Email is required.</small>
        <small *ngIf="EmailInput.errors?.['email']">Invalid email format.</small>
      </div>
    </div>
  </section>

  <section class="form-block invoice-item" >
    <h1>Invoice Item</h1>

   <!-- ✅ Updated Item Section - No required/min validations -->
<input
  type="text"
  [(ngModel)]="item.description"
  name="description"
  placeholder="Item Description"
/>

<input
  type="number"
  [(ngModel)]="item.quantity"
  name="itemQuantity"
  placeholder="Quantity"
/>

<input
  type="number"
  [(ngModel)]="item.price"
  name="price"
  placeholder="Price"
  step="0.01"
/>

<button type="button" (click)="addItem()">Add Item</button>


    <div class="input-box" style="grid-column: span 2;">
      <label>Due Date:</label>
      <input
        type="date"
        [(ngModel)]="dueDate"
        name="dueDate"
        #DueDateInput="ngModel"
        required
        [min]="todayDate"
      />
      <div class="error" *ngIf="DueDateInput.invalid && (DueDateInput.dirty || DueDateInput.touched)">
        <small *ngIf="DueDateInput.errors?.['required']">Due Date is required.</small>
      </div>
    </div>
  </section>

  <section class="form-block payment-info">
    <h1>Payment Info</h1>

    <div class="input-box">
      <input
        type="text"
        [(ngModel)]="payment.method"
        name="PaymentMethod"
        placeholder="Payment Method"
        required
        pattern="^[A-Za-z ]+$"
        #PaymentMethodInput="ngModel"
      />
      <div class="error" *ngIf="PaymentMethodInput.invalid && (PaymentMethodInput.dirty || PaymentMethodInput.touched)">
        <small *ngIf="PaymentMethodInput.errors?.['required']">Payment Method is required.</small>
        <small *ngIf="PaymentMethodInput.errors?.['pattern']">Only letters allowed.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="text"
        [(ngModel)]="payment.account_number"
        name="AccountNumber"
        placeholder="Account Number"
        required
        minlength="5"
        pattern="^[A-Za-z0-9]+$"
        #AccountNumberInput="ngModel"
      />
      <div class="error" *ngIf="AccountNumberInput.invalid && (AccountNumberInput.dirty || AccountNumberInput.touched)">
        <small *ngIf="AccountNumberInput.errors?.['required']">Account Number is required.</small>
        <small *ngIf="AccountNumberInput.errors?.['minlength']">Minimum 5 characters.</small>
        <small *ngIf="AccountNumberInput.errors?.['pattern']">Letters and numbers only.</small>
      </div>
    </div>

    <div class="input-box">
      <input
        type="text"
        [(ngModel)]="payment.bank"
        name="Bank"
        placeholder="Bank Name"
        required
        minlength="2"
        pattern="^[A-Za-z ]+$"
        #BankInput="ngModel"
      />
      <div class="error" *ngIf="BankInput.invalid && (BankInput.dirty || BankInput.touched)">
        <small *ngIf="BankInput.errors?.['required']">Bank Name is required.</small>
        <small *ngIf="BankInput.errors?.['minlength']">Minimum 2 characters required.</small>
        <small *ngIf="BankInput.errors?.['pattern']">Only letters allowed.</small>
      </div>
    </div>
  </section>

  <button
    type="submit"
    class="submit-btn"
    [disabled]="input.invalid || CIdExists"
  >
    Submit Invoice
  </button>
  

  <div *ngIf="errorMessage" class="alert error-msg">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="alert success-msg">{{ successMessage }}</div>
</form>

<a [routerLink]="['/main']" class="generate-btn">Generate Invoice</a>


